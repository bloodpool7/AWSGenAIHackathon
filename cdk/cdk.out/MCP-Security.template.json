{
 "Metadata": {
  "cdk_nag": {
   "rules_to_suppress": [
    {
     "reason": "SSM Parameter custom resource Lambda function requires basic execution role for CloudWatch logs",
     "id": "AwsSolutions-IAM4",
     "applies_to": [
      "Policy::arn:<AWS::Partition>:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
     ]
    },
    {
     "reason": "SSM Parameter custom resource Lambda function uses runtime defined by L2 construct",
     "id": "AwsSolutions-L1"
    }
   ]
  }
 },
 "Resources": {
  "MCPServerUserPool93568800": {
   "Type": "AWS::Cognito::UserPool",
   "Properties": {
    "AccountRecoverySetting": {
     "RecoveryMechanisms": [
      {
       "Name": "verified_phone_number",
       "Priority": 1
      },
      {
       "Name": "verified_email",
       "Priority": 2
      }
     ]
    },
    "AdminCreateUserConfig": {
     "AllowAdminCreateUserOnly": false
    },
    "AliasAttributes": [
     "email"
    ],
    "AutoVerifiedAttributes": [
     "email"
    ],
    "EmailVerificationMessage": "The verification code to your new account is {####}",
    "EmailVerificationSubject": "Verify your new account",
    "EnabledMfas": [
     "SOFTWARE_TOKEN_MFA"
    ],
    "MfaConfiguration": "ON",
    "Policies": {
     "PasswordPolicy": {
      "MinimumLength": 12,
      "RequireLowercase": true,
      "RequireNumbers": true,
      "RequireSymbols": true,
      "RequireUppercase": true
     }
    },
    "SmsVerificationMessage": "The verification code to your new account is {####}",
    "UserPoolAddOns": {
     "AdvancedSecurityMode": "ENFORCED"
    },
    "UserPoolName": "mcp-server-user-pool",
    "UserPoolTags": {
     "Project": "MCP-Servers-On-AWS"
    },
    "UserPoolTier": "PLUS",
    "VerificationMessageTemplate": {
     "DefaultEmailOption": "CONFIRM_WITH_CODE",
     "EmailMessage": "The verification code to your new account is {####}",
     "EmailSubject": "Verify your new account",
     "SmsMessage": "The verification code to your new account is {####}"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "MCP-Security/MCPServerUserPool/Resource"
   }
  },
  "MCPServerUserPoolCognitoDomainABC0440B": {
   "Type": "AWS::Cognito::UserPoolDomain",
   "Properties": {
    "Domain": "mcp-server-rrhcc9xd",
    "UserPoolId": {
     "Ref": "MCPServerUserPool93568800"
    }
   },
   "Metadata": {
    "aws:cdk:path": "MCP-Security/MCPServerUserPool/CognitoDomain/Resource"
   }
  },
  "MCPServerUserPoolMCPResourceServer2A905AE3": {
   "Type": "AWS::Cognito::UserPoolResourceServer",
   "Properties": {
    "Identifier": "mcp-server",
    "Name": "mcp-server",
    "Scopes": [
     {
      "ScopeDescription": "Read access to MCP Server",
      "ScopeName": "read"
     },
     {
      "ScopeDescription": "Write access to MCP Server",
      "ScopeName": "write"
     }
    ],
    "UserPoolId": {
     "Ref": "MCPServerUserPool93568800"
    }
   },
   "Metadata": {
    "aws:cdk:path": "MCP-Security/MCPServerUserPool/MCPResourceServer/Resource"
   }
  },
  "MCPServerUserPoolmcpuserclient88C9DD5D": {
   "Type": "AWS::Cognito::UserPoolClient",
   "Properties": {
    "AccessTokenValidity": 60,
    "AllowedOAuthFlows": [
     "implicit",
     "code"
    ],
    "AllowedOAuthFlowsUserPoolClient": true,
    "AllowedOAuthScopes": [
     "email",
     "openid",
     "profile",
     {
      "Fn::Join": [
       "",
       [
        {
         "Ref": "MCPServerUserPoolMCPResourceServer2A905AE3"
        },
        "/read"
       ]
      ]
     },
     {
      "Fn::Join": [
       "",
       [
        {
         "Ref": "MCPServerUserPoolMCPResourceServer2A905AE3"
        },
        "/write"
       ]
      ]
     }
    ],
    "CallbackURLs": [
     "http://localhost:2299/callback"
    ],
    "ClientName": "mcp-user-client",
    "ExplicitAuthFlows": [
     "ALLOW_USER_PASSWORD_AUTH",
     "ALLOW_ADMIN_USER_PASSWORD_AUTH",
     "ALLOW_USER_SRP_AUTH",
     "ALLOW_REFRESH_TOKEN_AUTH"
    ],
    "GenerateSecret": true,
    "IdTokenValidity": 60,
    "PreventUserExistenceErrors": "ENABLED",
    "RefreshTokenValidity": 43200,
    "SupportedIdentityProviders": [
     "COGNITO"
    ],
    "TokenValidityUnits": {
     "AccessToken": "minutes",
     "IdToken": "minutes",
     "RefreshToken": "minutes"
    },
    "UserPoolId": {
     "Ref": "MCPServerUserPool93568800"
    }
   },
   "Metadata": {
    "aws:cdk:path": "MCP-Security/MCPServerUserPool/mcp-user-client/Resource"
   }
  },
  "MCPServerWAF": {
   "Type": "AWS::WAFv2::WebACL",
   "Properties": {
    "DefaultAction": {
     "Allow": {}
    },
    "Name": "mcp-server-waf",
    "Rules": [
     {
      "Name": "AWS-AWSManagedRulesCommonRuleSet",
      "OverrideAction": {
       "None": {}
      },
      "Priority": 10,
      "Statement": {
       "ManagedRuleGroupStatement": {
        "Name": "AWSManagedRulesCommonRuleSet",
        "VendorName": "AWS"
       }
      },
      "VisibilityConfig": {
       "CloudWatchMetricsEnabled": true,
       "MetricName": "AWS-AWSManagedRulesCommonRuleSet",
       "SampledRequestsEnabled": true
      }
     },
     {
      "Action": {
       "Block": {}
      },
      "Name": "RateLimitRule",
      "Priority": 20,
      "Statement": {
       "RateBasedStatement": {
        "AggregateKeyType": "IP",
        "Limit": 1000
       }
      },
      "VisibilityConfig": {
       "CloudWatchMetricsEnabled": true,
       "MetricName": "RateLimitRule",
       "SampledRequestsEnabled": true
      }
     }
    ],
    "Scope": "REGIONAL",
    "Tags": [
     {
      "Key": "Project",
      "Value": "MCP-Servers-On-AWS"
     }
    ],
    "VisibilityConfig": {
     "CloudWatchMetricsEnabled": true,
     "MetricName": "MCPServerWAF",
     "SampledRequestsEnabled": true
    }
   },
   "Metadata": {
    "aws:cdk:path": "MCP-Security/MCPServerWAF"
   }
  },
  "UserPoolIdParameter574506B4": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Description": "The user pool ID for user authentication",
    "Name": "/mcp/cognito/user-pool-id-c8adc83b",
    "Tags": {
     "Project": "MCP-Servers-On-AWS"
    },
    "Type": "String",
    "Value": {
     "Ref": "MCPServerUserPool93568800"
    }
   },
   "Metadata": {
    "aws:cdk:path": "MCP-Security/UserPoolIdParameter/Resource"
   }
  },
  "UserPoolClientIdParameter29B97DEE": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Description": "The user pool client ID for user authentication",
    "Name": "/mcp/cognito/user-pool-client-id-c8adc83b",
    "Tags": {
     "Project": "MCP-Servers-On-AWS"
    },
    "Type": "String",
    "Value": {
     "Ref": "MCPServerUserPoolmcpuserclient88C9DD5D"
    }
   },
   "Metadata": {
    "aws:cdk:path": "MCP-Security/UserPoolClientIdParameter/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/12PTw+CMAzFP4v3MXUxMR4NHk0kEOPRjFFIgW1mf+BA+O6OIIR46nu/16Yto+x4oYcd720kiiZqMadD5rhoSEDvQehKodN0eFowidYtiUu16kXctOSottGPLDYFq70RkIHpwGwb/5IFxy2CctvGmYyk52XHaAhekF/jO7FWThcbVFXCDZfg5gWrGcfJPrz7+DCudAG0tvuOneg5PF5bxMh45VACTef6BY36oLEVAQAA"
   },
   "Metadata": {
    "aws:cdk:path": "MCP-Security/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "UserPoolId": {
   "Description": "The ID of the Cognito User Pool",
   "Value": {
    "Ref": "MCPServerUserPool93568800"
   }
  },
  "UserPoolClientId": {
   "Description": "The Client ID for the Cognito User Pool Client",
   "Value": {
    "Ref": "MCPServerUserPoolmcpuserclient88C9DD5D"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}